<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matriz de Decisiones Operativas - Condugas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        /* Estilos CSS idénticos a decisiones_estrategicas.html */
        #decisionNetwork { width: 100%; height: 80vh; border: 1px solid #e2e8f0; border-radius: 0.5rem; background-color: #f8fafc; position: relative; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .vis-tooltip { position: absolute; visibility: hidden; padding: 8px; white-space: nowrap; font-family: Inter, sans-serif; font-size: 13px; color: #1f2937; background-color: rgba(255, 255, 255, 0.95); border: 1px solid #d1d5db; border-radius: 0.375rem; z-index: 1000; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); pointer-events: none; }
        #decisionPanel { position: absolute; top: 1rem; right: -450px; width: 400px; max-width: 90%; height: calc(100% - 2rem); background-color: white; border-radius: 0.5rem; box-shadow: -5px 0px 15px rgba(0, 0, 0, 0.1); transition: right 0.4s ease-in-out; z-index: 20; overflow-y: auto; display: flex; flex-direction: column; }
        #decisionPanel.show { right: 1rem; }
        #decisionPanelContent { padding: 1.5rem; flex-grow: 1; }
        #decisionPanelHeader { padding: 1rem 1.5rem; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        #closeDecisionPanel { background: none; border: none; font-size: 1.5rem; line-height: 1; cursor: pointer; color: #6b7280; }
        #closeDecisionPanel:hover { color: #1f2937; }
        #decisionConsiderations ul { list-style-type: disc; list-style-position: inside; margin-left: 0.5rem; }
        #decisionConsiderations li { margin-bottom: 0.5rem; padding-left: 0.5rem; }
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007aff%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right .7em top 50%; background-size: .65em auto; padding-right: 2.5em; }
        .nav-links a { margin: 0 0.5rem; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: background-color 0.3s ease; font-weight: 500; }
        .nav-links a.active { background-color: #292d63; color: white; }
        .nav-links a:not(.active) { background-color: #e0e7ff; color: #3730a3; }
        .nav-links a:not(.active):hover { background-color: #c7d2fe; }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <header class="text-center mb-6">
        <h1 class="text-3xl md:text-4xl font-bold text-[#292d63]">Matriz de Decisiones y Responsabilidades Condugas</h1>
    </header>

 <nav class="nav-links flex flex-wrap justify-center mb-8 text-sm md:text-base">
        <a href="dashboard_principal.html">Dashboard Principal</a>
        <a href="objetivos_interactivos_detalle.html">Visualización de Objetivos</a>
        <a href="vision_general_procesos.html">Visión General de Procesos</a>
        <a href="decisiones_estrategicas.html">Decisiones Estratégicas</a>
        <a href="decisiones_tacticas.html">Decisiones Tácticas</a>
        <a href="decisiones_operativas.html" class="active" >Decisiones Operativas</a>
        <a href="decisiones_supervivencia.html">Decisiones de Supervivencia</a>
        <a href="flujo_decisiones.html">Flujo entre Niveles</a>
    </nav>
    <div class="mb-6 p-4 bg-white border border-gray-200 rounded-lg shadow-sm">
        <label for="decisionSelector" class="block text-sm font-medium text-gray-700 mb-2">Seleccione una Decisión Operativa:</label>
        <select id="decisionSelector" class="block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-[#1d70b7] focus:border-[#1d70b7] text-base">
            <option value="">-- Elegir Decisión --</option>
        </select>
    </div>

    <main class="relative">
        <div id="decisionNetwork" class="shadow-lg rounded-lg"></div>
        <div id="tooltip" class="vis-tooltip"></div>
        <div id="decisionPanel">
            <div id="decisionPanelHeader">
                <h3 id="panelDecisionName" class="text-xl font-bold text-[#292d63]">Consideraciones Clave</h3>
                <button id="closeDecisionPanel" title="Cerrar">&times;</button>
            </div>
            <div id="decisionPanelContent" class="text-gray-700 text-sm">
                <div id="decisionConsiderations" class="mt-1"></div>
            </div>
        </div>
    </main>

    <footer class="text-center mt-8 text-sm text-gray-500">
        Nivel Operativo - Generado para Condugas
    </footer>

    <script type="text/javascript">
        // --- Color Palette (Consistent) ---
        const condugasColors = {
            decision: '#ffda05',      // Condugas Yellow for Operational Decisions
            responsible: '#292d63',   // Dark Blue for Responsible
            impactCategory: '#1d70b7',// Light Blue for Impact Categories
            impactItem: '#f8b133',    // Orange/Yellow for specific items
        };

        // --- Data for Operational Decisions ---
        const areaLabels = { /* Same as strategic */
            "DIR": "Comité de Dirección", "EST": "Estrategia", "NN": "Nuevos Negocios", "TI": "Tecnología (TI)",
            "FIN": "Financiero", "LGL": "Legal", "LOG": "Logístico", "GH": "Gestión Humana",
            "GP": "Gerencia Proyectos", "COM": "Comercial", "MKT": "Marketing", "OPER": "Operaciones",
            "CLIENTES": "Clientes", "REGIONES": "Regiones", "ODP": "Oficina de Proyectos (ODP)",
            "TODAS": "Todas las Áreas", "SEG": "Seguridad", "CAL": "Calidad",
            "COORD_LOG": "Coordinador Logística", "SUP_MANT": "Supervisor Mantenimiento", "J_DIRECTO": "Jefe Directo",
            "ANALISTA_CP": "Analista Cuentas por Pagar", "COORD_CNT": "Coordinador Contable",
            "TEC_MANT": "Técnicos Mantenimiento", "EQUIPO_PROY_Y": "Equipo Proyecto Y"
        };

        const operationalDecisionsData = {
            "DEC_REPLAN_RUTA_DESPACHO": {
                name: "Replanificación de Ruta de Despacho por Cierre Vial",
                responsible: ["COORD_LOG"],
                impacts: {
                    "Objetivos Operativos": ["LOG-03 (Entregas OTD)", "LOG-01 (Control Costo Logístico)"],
                    "Sistemas Clave": ["Software de Ruteo", "GPS Vehicular"],
                    "Procesos/Áreas Clave": ["Programación Despachos", "Comunicación con Conductores", "Notificación a Cliente (si aplica GP/COM)"],
                    "Personas/Roles": ["Conductores", "Cliente (Receptor Mercancía)"],
                    "Recursos": ["Vehículos", "Combustible"]
                },
                considerations: [
                    "Urgencia de la entrega.",
                    "Disponibilidad de rutas alternativas y su estado.",
                    "Tiempo adicional estimado y costo de combustible.",
                    "Impacto en otras entregas programadas.",
                    "Necesidad de comunicar retraso al cliente (coordinar con Comercial/GP).",
                    "Seguridad de la ruta alternativa.",
                    "Registro del incidente y la solución para análisis futuros."
                ]
            },
            "DEC_APROB_VACACIONES_URG": {
                name: "Aprobación de Solicitud de Vacaciones Urgente (Colaborador Clave)",
                responsible: ["J_DIRECTO", "GH"],
                impacts: {
                    "Objetivos Operativos": ["GH-02 (Control Ausentismo)", "Cumplimiento Tareas Equipo"],
                    "Sistemas Clave": ["Odoo (Módulo RRHH - Ausencias)"],
                    "Procesos/Áreas Clave": ["Planificación de Trabajo del Equipo", "Cobertura de Tareas"],
                    "Personas/Roles": ["Colaborador Solicitante", "Compañeros de Equipo (posible sobrecarga)"],
                    "Continuidad Operativa": ["Asegurar que tareas críticas del colaborador sean cubiertas."]
                },
                considerations: [
                    "Motivo de la urgencia y justificación.",
                    "Impacto de la ausencia en los proyectos/tareas actuales del equipo.",
                    "Posibilidad de redistribuir tareas o posponer actividades no críticas.",
                    "Disponibilidad de otros miembros del equipo para cubrir.",
                    "Políticas de vacaciones de la empresa y precedentes.",
                    "Saldo de días de vacaciones del colaborador.",
                    "Comunicación clara al equipo sobre la ausencia y cobertura."
                ]
            },
            "DEC_RESOL_DISCREP_FACTURA": {
                name: "Resolución de Discrepancia en Factura de Proveedor Crítico",
                responsible: ["ANALISTA_CP", "COORD_CNT"],
                impacts: {
                    "Objetivos Operativos": ["FIN-10 (Eficiencia Procesos Fin.)", "CNT-04 (Cumplimiento Obligaciones)"],
                    "Sistemas Clave": ["Odoo (Cuentas por Pagar, Compras)", "Portal Proveedores (si existe)"],
                    "Procesos/Áreas Clave": ["Recepción y Validación Facturas", "Proceso de Pago a Proveedores", "Relación con Proveedores (LOG/Compras)"],
                    "Personas/Roles": ["Proveedor", "Área de Compras/Logística (originadora del pedido)"],
                    "Flujo de Caja": ["Retrasos en pagos pueden afectar relación o descuentos."]
                },
                considerations: [
                    "Naturaleza y monto de la discrepancia (cantidad, precio, impuestos, etc.).",
                    "Documentación de soporte (orden de compra, nota de recepción, contrato).",
                    "Comunicación con el proveedor para aclarar la diferencia.",
                    "Consulta con el área interna que solicitó el bien/servicio.",
                    "Políticas internas para manejo de disputas con proveedores.",
                    "Impacto en plazos de pago y posibles penalizaciones o pérdida de descuentos.",
                    "Necesidad de ajustes contables o notas crédito/débito."
                ]
            }
            // Add more operational decision examples here
        };

        // --- Vis.js Network Setup (Identical logic, different data source) ---
        const container = document.getElementById('decisionNetwork');
        const decisionSelector = document.getElementById('decisionSelector');
        const decisionPanel = document.getElementById('decisionPanel');
        const panelDecisionName = document.getElementById('panelDecisionName');
        const decisionConsiderationsDiv = document.getElementById('decisionConsiderations');
        const closeDecisionPanelButton = document.getElementById('closeDecisionPanel');
        const tooltip = document.getElementById('tooltip');

        let network = null;
        let allNodes = new vis.DataSet();
        let allEdges = new vis.DataSet();

        // Populate selector
        for (const key in operationalDecisionsData) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = operationalDecisionsData[key].name;
            decisionSelector.appendChild(option);
        }

        function drawDecisionNetwork(decisionKey) {
            if (!decisionKey) {
                if (network) network.destroy();
                decisionPanel.classList.remove('show');
                return;
            }

            const decision = operationalDecisionsData[decisionKey]; // Use operational data
            allNodes = new vis.DataSet();
            allEdges = new vis.DataSet();

            // 1. Central Decision Node
            allNodes.add({
                id: decisionKey,
                label: decision.name,
                shape: 'ellipse',
                color: condugasColors.decision, // Operational decision color
                font: { size: 16, color: '#854d0e', face: 'Inter', bold: true }, // Dark brown text for yellow
                margin: 20,
                widthConstraint: { maximum: 300 },
                title: "Clic para ver Consideraciones Clave",
                mass: 3
            });

            // 2. Responsible Area(s)/Role(s) Nodes
            decision.responsible.forEach((respId) => {
                const respNodeId = `resp_${respId}_${decisionKey}`;
                allNodes.add({
                    id: respNodeId,
                    label: areaLabels[respId] || respId,
                    shape: 'box',
                    color: condugasColors.responsible,
                    font: { color: 'white', size: 12, face: 'Inter', bold: true },
                    margin: 10,
                    title: `Responsable: ${areaLabels[respId] || respId}`,
                    mass: 2
                });
                allEdges.add({ from: decisionKey, to: respNodeId, length: 180, arrows: 'to', color: {color: condugasColors.responsible, opacity:0.8} });
            });

            // 3. Impact Category Nodes and Item Nodes
            for (const category in decision.impacts) {
                const categoryNodeId = `cat_${category.replace(/\s+/g, '')}_${decisionKey}`;
                allNodes.add({
                    id: categoryNodeId,
                    label: category,
                    shape: 'box',
                    color: { background: condugasColors.impactCategory, border: '#0f769e' },
                    font: { color: 'white', size: 13, face: 'Inter', bold: true },
                    margin: 12,
                    title: `Categoría de Impacto: ${category}`,
                    mass: 1.5
                });
                allEdges.add({ from: decisionKey, to: categoryNodeId, length: 220, arrows: 'to', color: {color: condugasColors.impactCategory, opacity:0.8} });

                decision.impacts[category].forEach((item, index) => {
                    const itemNodeId = `item_${category.replace(/\s+/g, '')}_${index}_${decisionKey}`;
                    allNodes.add({
                        id: itemNodeId,
                        label: item,
                        shape: 'ellipse',
                        color: { background: condugasColors.impactItem, border: '#b45309' }, // Orange border for items
                        font: { color: '#431407', size: 11, face: 'Inter' }, // Dark brown text
                        margin: 8,
                        title: `Impacto Específico: ${item}`,
                        widthConstraint: { maximum: 200 },
                        mass: 1
                    });
                    allEdges.add({ from: categoryNodeId, to: itemNodeId, length: 150, arrows: 'to', color: {color: condugasColors.impactItem, opacity:0.8} });
                });
            }


            const data = { nodes: allNodes, edges: allEdges };
            const options = { /* Identical options to strategic */
                nodes: { borderWidth: 1.5, borderWidthSelected: 3 },
                edges: { smooth: { type: 'cubicBezier', forceDirection: 'vertical', roundness: 0.4 }, width: 1.5 },
                physics: { enabled: true, solver: 'forceAtlas2Based', forceAtlas2Based: { gravitationalConstant: -120, centralGravity: 0.025, springLength: 180, springConstant: 0.1, damping: 0.6, avoidOverlap: 0.8 }, stabilization: { iterations: 1200, fit: true } },
                interaction: { hover: true, tooltipDelay: 200, navigationButtons: true, dragNodes: true, dragView: true, zoomView: true, hoverConnectedEdges: true },
                layout: { hierarchical: false }
            };

            if (network) network.destroy();
            network = new vis.Network(container, data, options);

            network.on('click', function(params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    if (nodeId === decisionKey) {
                        panelDecisionName.textContent = `Consideraciones: ${decision.name}`;
                        let considerationsHtml = '<ul>';
                        decision.considerations.forEach(con => { considerationsHtml += `<li>${con}</li>`; });
                        considerationsHtml += '</ul>';
                        decisionConsiderationsDiv.innerHTML = considerationsHtml;
                        decisionPanel.classList.add('show');
                    } else { decisionPanel.classList.remove('show'); }
                } else { decisionPanel.classList.remove('show'); }
            });
            network.on("hoverNode", function (params) { const nodeId = params.node; const nodeData = allNodes.get(nodeId); if (nodeData && nodeData.title) { tooltip.innerHTML = nodeData.title; tooltip.style.visibility = 'visible'; const pointer = params.pointer.DOM; tooltip.style.left = pointer.x + 10 + 'px'; tooltip.style.top = pointer.y + 10 + 'px'; } });
            network.on("blurNode", function () { tooltip.style.visibility = 'hidden'; });
            network.once('stabilizationIterationsDone', function() { network.setOptions({ physics: false }); });
        }

        decisionSelector.addEventListener('change', function() { drawDecisionNetwork(this.value); });
        closeDecisionPanelButton.addEventListener('click', function() { decisionPanel.classList.remove('show'); });
    </script>
</body>
</html>
